2026-01-09

- Implemented MVCC visibility bitmap:
  - Backend computes per-page bitmap via HeapTupleSatisfiesVisibility, writes it directly to SHM (no Vec allocs), and sends vis_len in metadata.
  - Executor applies bitmap in PgScanStream to skip invisible tuples before decoding.
- Fixed EXPLAIN EndScan issue: gate sending EndScan to executor only if execution started.
- Replaced use of missing ItemIdIsNormal binding with raw ItemIdData flags unpacking.
- Added pgx test (pg_test) that compares core SELECT vs pg_fusion SELECT for visibility; skips if pg_fusion is not preloaded.
- Moved wire-tuple unit test from postgres to pg_test; adjusted storage tests to avoid direct SPI snapshot misuse.

- Fixed CI misaligned pointer panic in lock-free buffer tests:
  - Switched tests to allocate buffers via `lockfree_buffer_layout` + `from_layout` (aligned).
  - Added `debug_assert!` on alignment in `LockFreeBuffer::new` to catch misuse in debug builds.

- Planning notes for performance:
  - Documented current lack of filter/limit pushdown in executor and proposed Inexact filter pushdown + LIMIT early stop.
 - Added plan for block-local partial aggregates (SUM/MIN/MAX/AVG) and long-term `PgAggScanExec` to avoid building full Arrow rows.

- visibility: fix slot race
  - Executor now copies heap page and visibility bitmap out of SHM on receipt of `Heap` meta to avoid producer overwriting the same slot before decode.
  - `PgScanStream` no longer borrows SHM; it iterates LPs by 1-based index over the owned page buffer, applies the bitmap, and decodes tuples safely.
  - Server enqueues the next `request_heap_block` only after enqueuing the current block (ownership transfer is explicit via copies).
